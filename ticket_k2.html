<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title class="tag-name">TT门票</title>
<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<link rel="stylesheet" type="text/css" href="static/main.css">
<link href="static/semantic.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="static/stylend.css?v=5112">
<style>
.distribution{text-align:center}.distribution .lead{font-size:15px}.distribution .team{border-right:0 solid #565656}.distribution .team:last-child{border-right:0}.distribution .team img{width:75%}.distribution .team p{font-size:9pt}.team input:checked~img{filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 15px #00c1c8) drop-shadow(0 0 5px #0df);-webkit-filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 15px #00c1c8) drop-shadow(0 0 5px #0df)}.team img:hover{animation:slowpulse 1s infinite;filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 25px #00c1c8) drop-shadow(0 0 5px #0df)}.checkmark:after{content:"";position:absolute;display:none}.ethglow{filter:drop-shadow(0 0 2px #0b002b) drop-shadow(0 0 25px #00c1c8) drop-shadow(0 0 5px #0df);-webkit-filter:drop-shadow(0 0 2px #0b002b) drop-shadow(0 0 25px #00c1c8) drop-shadow(0 0 5px #0df)}.ethglow-slow{filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 25px #2ee1ef) drop-shadow(0 0 5px #008aff);-webkit-filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 25px #2ee1ef) drop-shadow(0 0 5px #008aff)}.ethglow-green{filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 25px #0c0) drop-shadow(0 0 5px #0f0);-webkit-filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 25px #0c0) drop-shadow(0 0 5px #0f0)}.ethglow-calm-down-sumpunk{filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 1px #00c1c8) drop-shadow(0 0 2px #0df);-webkit-filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 1px #00c1c8) drop-shadow(0 0 2px #0df)}.ethglow-its-okay-justo{filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 10px #00c1c8) drop-shadow(0 0 2px #0df);-webkit-filter:drop-shadow(0 0 2px #2b002b) drop-shadow(0 0 10px #00c1c8) drop-shadow(0 0 2px #0df)}.form-radio{opacity:0;position:absolute}.text-shadow-blue{text-shadow:0 0 5px blue,0 0 10px blue,0 0 30px blue}.text-shadow-zz{text-shadow:0 0 5px red,0 0 10px red,0 0 30px red}.text-shadow-yellow{text-shadow:0 0 5px yellow,0 0 10px yellow,0 0 30px yellow}.text-shadow-bl{text-shadow:0 0 5px black,0 0 10px red,0 0 30px black}.alertify-logs{z-index:1001}.ui.button.graceButton2{color:white;background:-webkit-linear-gradient(left,#02e5d1 0,#4391fd 100%);background:linear-gradient(90deg,#FFA500 0,#D2691E 100%);border:0;outline:0;padding:0;line-height:3rem;margin:0}.purchas-keys-buttons{display:flex;flex-wrap:nowrap} .purchas-keys-buttons div{line-height:1.5rem;flex:1;text-align:center;border:1px solid #ff8031;border-right:0} .purchas-keys-buttons div:nth-child(1){border-top-left-radius:4px;border-bottom-left-radius:4px}.purchas-keys-buttons div{color:#d37d4a;margin-top:1.5rem;transition:.3s ease-in-out all;cursor:pointer}.purchas-keys-buttons div:hover{background:#ff8031;color:white}.purchas-keys-buttons div:last-child{border-top-right-radius:4px;border-bottom-right-radius:4px;border-right:1px solid #ff8031}.purchas-keys-buttons div:nth-child(1),.purchas-keys-buttons div:nth-child(2),.purchas-keys-buttons div:nth-child(3){flex:5;line-height:3rem}.send-eth.ui.grid{margin-top:1.5rem}.send-eth.ui.grid .ui.button.blue{font-size:1.25rem;line-height:3rem;padding:0;border-radius:.25rem}div.rightnav{font-weight:bolder; position:absolute; right:0px; top:0px;float:right;margin:0 12px 0 12px;}div.rightnav a{margin-left:18px;font-weight:bolder;color:white;}.clearsha{text-shadow:none;}
</style>
<link rel="shortcut icon" href="static/logo.png">
</head>


 <body class="" style="position: relative; overflow: visible;"> 
 <div class="bg"> </div><div class="rightnav">
           <a class="item language-item language_en" language-value="en" href="http://aplopro.com/ticket.html">镜像1</a>    
 <a class="item language-item language_en" language-value="en" href="http://27.102.102.243/ticket.html">镜像2</a>
 <a class="item language-item language_en" language-value="en" href="http://27.102.102.243/ticket.html">镜像3</a>
 
 <a class="item language-item language_en" language-value="en" href="index.html" target="_blank">阿波罗计划</a>
 <a class="item language-item language_en refresh" language-value="en">刷新</a>
 <a class="item language-item language_en" language-value="en" href="ticket.html">English</a>
 <a class="item language-item language_zh" language-value="zh" href="ticket.html">中文</a>
 </div>
 <div style="clear:both;"></div> <div class="header-container"> 
 <!-- Header -->
 <header id="header" style="background:rgba(0,0,0,0);margin-top:10px">
 <div class="content" style="border:0px;">
 <div class="inner">
 <div id="sparkle">
 <h3 class="" style="text-shadow: 0.1em 0.1em 0.2em black">TT门票</h3>
 <h5 class="" style="text-shadow: 0.1em 0.1em 0.2em black cont">
     <a target="_blank" href="https://tronscan.io/#/contract/TAqgD75D2MLtgRLy4tFLhcUu6MUXHBzCgK/transfers">查看合约</a></h5>
 </div>
 
 
 <div class="ui center aligned basic segment" style="margin-top:-10px;"> 
 
 
 
<br>
 <div class="ui labeled icon label" style="color:white;font-size:20px;font-weight:normal;background:rgba(0,0,0,0);">
 <span class="r-time text-shadow-yellow">您有门票:</span>  <span class="mytt r-pot text-shadow-yellow">--</span> 
 <span style="font-size:13px;text-shadow-yellow;">&nbsp;&nbsp;</span></div>
 <br>
 
 
 <div class="ui labeled icon label" style="color:white;font-size:18px;font-weight:normal;background:rgba(0,0,0,0);">
 <span class="r-time text-shadow-yellow">账户:</span>  <span id="myadd" class="r-pot text-shadow-yellow">--</span> 
 </div>
 <br>
 <div class="ui labeled icon label" style="color:white;font-size:20px;font-weight:normal;background:rgba(0,0,0,0);">
 <span class="r-time text-shadow-yellow">发行总量:</span>  <span id="myadd" class="r-pot text-shadow-yellow">10000000</span> 
 </div>
 <br>
 <div class="ui labeled icon label" style="color:white;font-size:20px;font-weight:normal;background:rgba(0,0,0,0);">
 <span class="r-time text-shadow-yellow">1TRX可兑换TT:</span>  <span class="myrate r-pot text-shadow-yellow">--</span> 
 </div>
 
 
 <br>
 <div class="ui labeled icon label" style="color:white;font-size:20px;font-weight:normal;background:rgba(0,0,0,0);">
 <span class="r-time text-shadow-yellow" style="color:red">钱包:</span>  <span id="mycon" class="r-pot text-shadow-yellow" style="color:red"> 未连接 </span> 
 </div>
 
 
 </div>
 </div>
 </div>
 </header>
 </div> 
 
 <div class="home-container ui container"> 
 <div style="background:rgba(0,0,0,0.6);border:0px;border-radius:10px;margin-top:-20px;" class="ui segment"> 
 
 <div class="ui column grid"><div class="column"> 
 
<div class="ui horizontal header" style="margin-bottom:0px;"> 
 使用钱包浏览器?   <a href="ticket.html">点击这里</a> 可设置节点&nbsp;<span style="color:red">https://tron-mainnet.token.im</span> 或
 <span style="color:red">https://trx.mytokenpocket.vip</span>或
 <span style="color:red">https://api.trongrid.io</span>
  </div>
 <div class="ui horizontal header" style="margin-bottom:-20px;"> 
 导入私钥?   点击这里&nbsp;<a href="ticket_k.html">连节点1</a>&nbsp;&nbsp;<a href="ticket_k2.html">连节点2</a>&nbsp;&nbsp;<a href="ticket_k3.html">连节点3</a>
  </div>
 <!--
 <div class="purchas-keys-buttons"> 
 <div id="connectweb" style="background:#ff8031;color:white;"> 连接钱包 </div> 
 <div id="eth-connected"> 未连接 </div> 
 
 </div> 
 
 <div style="color:#ffffff;font-weight:bold;text-align:center;vertical-align:middle;border:0px solid red;margin-bottom:-18px;"> 
  OR
  </div>
  -->
 <div class="purchas-keys-buttons"> 
 <div id="loadkey" style="background:#ff8031;color:white"> 导入私钥 </div> 
 
 <div id="eth-five"> <input type="text" value="" style="margin:5px;padding:5px;width:95%" name="privkey" id="privkey" placeholder="私钥"> </div> 
 </div>
 
 </div></div></div>
 
 
 
 
 <div class="home-container ui container"> 
 <div style="background:rgba(0,0,0,0.6);border:0px;border-radius:10px;margin-top:0px;" class="ui segment"> 
 <div class="ui column grid"><div class="column"> <div class="purchas-keys-buttons"> 
 <div id="trx-1"> 100 TRX </div> 
 <div id="trx-2"> 1500 TRX </div> 
 <div id="trx-3"> 5000 TRX </div> 
 </div> 
 
 <div class="purchas-keys-buttons"> 
 <div id="eth-one"> 或其它数额(TRX): </div> 
 <div id="eth-five"> <div class="ui horizontal verticle header"> 
 <input type="text" value="5000" style="margin:5px;padding:5px;width:95%" name="deposit_amount" id="deposit_amount"> 
 </div></div> 
 </div> 
 
 
 
 <div class="send-eth ui grid"> 
 <div class="sixteen wide computer eight wide tablet sixteen wide mobile column"> 
 <button class="ui button fluid btn-send graceButton2 deposit">
 <span class="tag-send-eth deposittrx">兑换</span> 
 TT</button> 

   
  
 </div> </div> </div> </div> </div>
 
 
 
 <div class="home-container ui container"> 
 <div style="background:rgba(0,0,0,0.6);border:0px;border-radius:10px;margin-top:0px;" class="ui segment"> 
 <div class="ui column grid"><div class="column"> 
 
 <div class="purchas-keys-buttons"> 
 <div id="eth-one"> 转出TT数额(TT): </div> 
 <div id="eth-five"> <div class="ui horizontal verticle header"> 
 <input type="text" value="0" style="margin:5px;padding:5px;width:95%" name="transfer_amount" id="transfer_amount"> 
 </div></div> 
 </div> 
 
 <div class="purchas-keys-buttons"> 
 <div id="eth-one"> 转至波场地址: </div> 
 <div id="eth-five"> <div class="ui horizontal verticle header"> 
 <input type="text" value="" style="margin:5px;padding:5px;width:95%" name="to_add" id="to_add"> 
 </div></div> 
 </div> 
 
 
 
 <div class="send-eth ui grid"> 
 <div class="sixteen wide computer eight wide tablet sixteen wide mobile column"> 
 <button class="ui button fluid btn-send graceButton2 transfertoken">
 <span class="tag-send-eth deposittrx">转出</span> 
 TT</button> 

   
  
 </div> </div> </div> </div> </div>
 
 
 
 
 <script src="static/TronWeb.js"></script>
 <script src="static/jquery.min.js"></script> <script src="static/fastclick.min.js"></script>
 <script src="static/clipboard.min.js"></script>
 <script src="static/bignumber.min.js"></script><script src="static/alertify.js"></script><script src="static/store.min.js"></script>
 <script src="static/semantic.min.js"></script><script src="static/lib-tick.js"></script><script src="static/lang.js?rand=1.12"></script> 
 
 <script>
 
const HttpProvider = TronWeb.providers.HttpProvider;

//const fullNode = new HttpProvider("https://api.shasta.trongrid.io");
//const solidityNode = new HttpProvider("https://api.shasta.trongrid.io");
//const eventServer = new HttpProvider("https://api.shasta.trongrid.io");


//const fullNode = new HttpProvider("https://api.nileex.io/");
//const solidityNode = new HttpProvider("https://api.nileex.io/");
//const eventServer = new HttpProvider("https://event.nileex.io/");

const fullNode = new HttpProvider("https://tron-mainnet.token.im");
const solidityNode = new HttpProvider("https://tron-mainnet.token.im");
const eventServer = new HttpProvider("https://tron-mainnet.token.im");

const CONTRACT = "TAqgD75D2MLtgRLy4tFLhcUu6MUXHBzCgK";


var tronWeb;
var addressActive;
var connected;

var contract;
$(document).ready(function(){
    $("#privkey").val('');
    
    $(".refresh").click(function(){
        alert("已刷新");
        window.location.reload();
    });
    
    
    var pk=getCookie("pkey");
    if(pk){
        $("#privkey").val(pk);
    }
    
    
    
    
    $("#connectweb").click(function(){
        if (window.tronWeb) {
            tronWeb = window.tronWeb;
            async function c(){
                addressActive=tronWeb.defaultAddress.base58;
                if(!addressActive){
                const nodes = await tronWeb.isConnected();
                const connected = !Object.entries(nodes).map(([name, connected]) => {
     
                if (!connected) {
                    console.error(`Error: ${name} is not connected`);
                }
                    return connected;
                }).includes(false);
                }
            if ((connected)||(addressActive)){
                
                addressActive=tronWeb.defaultAddress.base58;
                if(addressActive){
                    $("#myadd").html(addressActive);
                    $("#eth-connected").html("<span style='color:red'>已连接</span>");
                    
                    $("#mycon").html("已连接");

                    if(!contract){
                    const {
                            abi
                        } = await tronWeb.trx.getContract(CONTRACT);
                    contract = tronWeb.contract(abi.entrys, CONTRACT);
                    }
                    
                    var mytt= await contract.methods.getTokenBalance(addressActive).call();
                    $(".mytt").html((mytt)/1000000);
                    var myrate= await contract.methods.getRate().call();
                    $(".myrate").html((myrate)/1000.0);
                    
                    

                    Toast("已连接",3000);
                }else{
                    Toast("钱包未连接",3000);
                }
            }else{
       
                
                $("#eth-connected").html("未连接");
                Toast("钱包未连接",3000);
            }
            };
            c();
            
            
        }else{
         
            
            $("#eth-connected").html("未连接");
            Toast("未连接",3000);
        }
    });
    ///////////////////////
    $("#loadkey").click(function(){
     
        var privkey=$("#privkey").val();
        tronWeb = new TronWeb(fullNode, solidityNode, eventServer,privkey);
        addressActive=tronWeb.address.fromPrivateKey(privkey);
        if(!(tronWeb.isAddress(addressActive))){
            Toast("私钥无效",3000);
            return;
        }
        //document.cookie="pkey="+privkey;
        setCookie("pkey",privkey);
        if (tronWeb) {
            async function k(){
                const nodes = await tronWeb.isConnected();
                const connected = !Object.entries(nodes).map(([name, connected]) => {
     
                if (!connected) {
                    console.error(`Error: ${name} is not connected`);
                }
                return connected;
                }).includes(false);
                if (connected){
                
                    addressActive=tronWeb.address.fromPrivateKey(privkey);
                    if(addressActive){
                        alert("私钥已导入");
                        $("#myadd").html(addressActive);
                       
                        $("#eth-connected").html("已连接");
                        $("#mycon").html("已连接");
                        if(!contract){
                    const {
                            abi
                        } = await tronWeb.trx.getContract(CONTRACT);
                    contract = tronWeb.contract(abi.entrys, CONTRACT);
                    }
                        
                        var mytt= await contract.methods.getTokenBalance(addressActive).call();
                        $(".mytt").html((mytt)/1000000);
                        var myrate= await contract.methods.getRate().call();
                        $(".myrate").html((myrate)/1000.0);
                        
                        var p=hideCode(privkey, 5, 3);
                        $("#privkey").val(p);

                        Toast("已连接",3000);
                    }else{
                        Toast("私钥无效",3000);
                    }
                    
                }else{
                
                   
                    $("#eth-connected").html("未连接");
                    Toast("未连接",3000);
                }
            };
            k();
            
        }else{

           
            $("#eth-connected").html("未连接");
            Toast("未连接",3000);
        }
        
    });
    
    
    $("#trx-1").click(function(){
        $("#deposit_amount").val("100");
    });
    $("#trx-2").click(function(){
        $("#deposit_amount").val("1500");
    });
    $("#trx-3").click(function(){
        $("#deposit_amount").val("5000");
    });
    
    
    $(".transfertoken").click(function(){
        addressActive=tronWeb.defaultAddress.base58;
        if(!addressActive){
            Toast("请先连接钱包",3000);
        }else{
            async function transfertoken(){
                var flag = confirm("确认提交?");
                if(!flag){
                    return;
                }
                var transfer_amount=$("#transfer_amount").val();
                if(!((transfer_amount>0)&&(transfer_amount<5000000))){
                    alert("数量无效");
                    return;
                }
                var transfer_amount1=parseInt(transfer_amount)*1000000;
                var to_add=$("#to_add").val();
                if(to_add==''){alert("请填入对方波场地址");return;}
                alert("转出TT请求已提交区块链");
                if(!contract){
                    const {
                            abi
                        } = await tronWeb.trx.getContract(CONTRACT);
                    contract = tronWeb.contract(abi.entrys, CONTRACT);
                    }
                let args = {
                    shouldPollResponse: true
                }
                try{
                let result  = await contract.transfer(to_add,transfer_amount1).send(args);
                console.log(result.toString());
                }catch(e){
                    alert("转出TT错误");
                }
                
                
            }
            transfertoken();
        }
        
    });
    
    
    

    
   $(".deposit").click(function(){
        addressActive=tronWeb.defaultAddress.base58;
        if(!addressActive){
            Toast("请先连接钱包",3000);
        }else{

     
            async function deposit(){
                var flag = confirm("确认提交?");
                if(!flag){
                    return;
                }
               
                var deposit_amount=$("#deposit_amount").val();
                var deposit_amount1=parseInt(deposit_amount)*1000000;
                if(!((deposit_amount>0)&&(deposit_amount<5000000))){
                    Toast("数量无效",3000);
                    return;
                }
               
                        alert("兑换请求已提交区块链");

                        if(!contract){
                    const {
                            abi
                        } = await tronWeb.trx.getContract(CONTRACT);
                    contract = tronWeb.contract(abi.entrys, CONTRACT);
                    }

                        let args = {
                            callValue:deposit_amount1,
                            shouldPollResponse: true
                        }
                        
                        try{
                        let result  = await contract.exchange().send(args);
                        console.log(result.toString());
                        }catch(e){
                            alert("兑换失败");
                            return;
                        }
                        alert("兑换请求已提交");
                        var mytt= await contract.methods.getTokenBalance(addressActive).call();
                        $(".mytt").html((mytt)/1000000);
                        $("#deposit_amount").val(5000);

                        //Toast("兑换请求已提交区块链",3000);
             

                
            };

                deposit();

            
        }
    });
 
});



        setInterval(async function(){ 
    
            addressActive=tronWeb.defaultAddress.base58;
            if(addressActive){
                if(!contract){
                    const {
                            abi
                        } = await tronWeb.trx.getContract(CONTRACT);
                    contract = tronWeb.contract(abi.entrys, CONTRACT);
                    }
                $("#myadd").html(addressActive);
                
                $("#eth-connected").html("已连接");
                $("#mycon").html("已连接");
                
                
                var mytt= await contract.methods.getTokenBalance(addressActive).call();
                $(".mytt").html((mytt)/1000000);
                
                var myrate= await contract.methods.getRate().call();
                $(".myrate").html((myrate)/1000.0);
                


            }
        }, 2000);




 function Toast(msg,duration){
      duration=isNaN(duration)?3000:duration;
      var m = document.createElement('div');
      m.innerHTML = msg;
      m.style.cssText="max-width:60%;min-width: 150px;padding:0 14px;height: 40px;color: rgb(255, 255, 255);line-height: 40px;text-align: center;border-radius: 4px;position: fixed;top: 50%;left: 50%;transform: translate(-50%, -50%);z-index: 999999;background: rgba(0, 0, 0,.7);font-size: 16px;";
      document.body.appendChild(m);
      setTimeout(function() {
        var d = 0.5;
        m.style.webkitTransition = '-webkit-transform ' + d + 's ease-in, opacity ' + d + 's ease-in';
        m.style.opacity = '0';
        setTimeout(function() { document.body.removeChild(m) }, d * 1000);
      }, duration);
    }
    
 function hideCode(str, frontLen, endLen) {
    var len = str.length - frontLen - endLen;
    var xing = '';
    for (var i = 0; i < len; i++) {
        xing += '*';
    }
    return str.substring(0, frontLen) + xing + str.substring(str.length - endLen);
};

function timeConvert(timestamp,num){//num:0 YYYY-MM-DD  num:1  YYYY-MM-DD hh:mm:ss // timestamp:时间戳 
            timestamp = timestamp+'';
            timestamp = timestamp.length==10?timestamp*1000:timestamp;
            var date = new Date(timestamp);
            var y = date.getFullYear();  
            var m = date.getMonth() + 1;  
            m = m < 10 ? ('0' + m) : m;  
            var d = date.getDate();  
            d = d < 10 ? ('0' + d) : d;  
            var h = date.getHours();
            h = h < 10 ? ('0' + h) : h;
            var minute = date.getMinutes();
            var second = date.getSeconds();
            minute = minute < 10 ? ('0' + minute) : minute;  
            second = second < 10 ? ('0' + second) : second; 
            if(num==0){
                return y + '-' + m + '-' + d;  
            }else{
                return y + '-' + m + '-' + d +' '+ h +':'+ minute +':' + second;  
            }
}

function getUrlParameter(name){
        name = name.replace(/[]/,"\[").replace(/[]/,"\[").replace(/[]/,"\\\]");
        var regexS = "[\\?&]"+name+"=([^&#]*)";
        var regex = new RegExp( regexS );
        var results = regex.exec(window.parent.location.href );
        if( results == null ) return ""; else {
            return results[1];
        }
    };
    
function isInteger(x) {
        return (typeof x === 'number') && (x % 1 === 0);
    }
    
    function getCookie(cname)
{
  var name = cname + "=";
  var ca = document.cookie.split(';');
  for(var i=0; i<ca.length; i++) 
  {
    var c = ca[i].trim();
    if (c.indexOf(name)==0) return c.substring(name.length,c.length);
  }
  return "";
}
function setCookie(cname,cvalue){
    var d = new Date();
    d.setTime(d.getTime()+(15*60*1000));
    var expires = "expires="+d.toGMTString();
    document.cookie = cname+"="+cvalue+"; "+expires;
}

 </script>
 </body>
</html>